<!DOCTYPE html>
<html>
  <head>
    <title>SDR Transmitter</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }
      .homeButton {
        position: fixed;
        top: 1em;
        left: 1em;
        z-index: 10;
      }
      .homeButton button {
        height: 2em;
        width: 4.8em !important;
        background: cornflowerblue;
        font-size: large;
        border-radius: 7px;
      }
      .banner {
        width: 100%;
        height: 10%;
        background-color: #c1156f;
        color: white;
        text-align: center;
        padding: 20px 0;
      }
      .container {
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      form {
        display: inline-block;
        text-align: left;
      }
      label,
      input,
      select,
      button {
        display: block;
        width: 100%;
        margin-bottom: 10px;
      }
      .buttons {
        display: flex;
        justify-content: center;
      }
      .buttons button {
        width: 150px;
        height: 50px;
        font-size: 16px;
        margin: 10px;
      }
      .start {
        background-color: #28a745;
        color: white;
        cursor: pointer;
      }
      .stop {
        background-color: grey;
        color: white;
        cursor: pointer;
      }
      .transmitting {
        background-color: yellow;
        color: black;
        animation: heartbeat 1.5s infinite;
      }
      @keyframes heartbeat {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body>
    <div class="homeButton">
      <button onclick="location.href='/'">Home</button>
      <button onclick="location.href='/'">Go back</button>
    </div>
    <div class="banner">
      <h1>BPSK Message Transmission</h1>
      <h2>Chandhar Research Labs</h2>
    </div>
    <div class="container">
      <form id="transmit-form">
        <label for="char_to_transmit">Text to transmit:</label>
        <input
          type="text"
          id="char_to_transmit"
          name="char_to_transmit"
          maxlength="100"
          required
        />

        <label for="modulation">Modulation Type:</label>
        <select id="modulation" name="modulation">
          {% for mod in modulations %}
          <option value="{{ mod }}">{{ mod }}</option>
          {% endfor %}
        </select>

        <label for="gain">Gain:</label>
        <input
          type="number"
          id="gain"
          name="gain"
          step="0.1"
          required
          value="50"
        />

        <label for="symbol_period">Symbol Period:</label>
        <input
          type="number"
          id="symbol_period"
          name="symbol_period"
          step="0.001"
          required
          value="0.1"
        />

        <div class="buttons">
          <button
            type="button"
            class="start"
            id="start-button"
            onclick="startTransmitting()"
          >
            Start
          </button>
          <button
            type="button"
            class="stop"
            id="stop-button"
            onclick="stopTransmitting()"
            disabled
          >
            Stop
          </button>
        </div>
      </form>
    </div>
    <script>
      function startTransmitting() {
        const form = document.getElementById("transmit-form");
        const formData = new FormData(form);

        fetch("/start", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "transmitting") {
              const startButton = document.getElementById("start-button");
              const stopButton = document.getElementById("stop-button");
              startButton.textContent = "Transmitting...";
              startButton.classList.add("transmitting");
              startButton.disabled = true;
              stopButton.disabled = false;
              stopButton.classList.remove("stop");
            }
          });
      }

      function stopTransmitting() {
        fetch("/stop", {
          method: "POST",
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "stopped") {
              const startButton = document.getElementById("start-button");
              const stopButton = document.getElementById("stop-button");
              startButton.textContent = "Start";
              startButton.classList.remove("transmitting");
              startButton.disabled = false;
              stopButton.disabled = true;
              stopButton.classList.add("stop");
            }
          });
      }
    </script>
  </body>
</html>
